=======QUEUE APC(Hybrid)=========
- APC are functions that execute asynchronously in the context
of a particular thread.
APC= Asynchronous Procedire Call
- Combines the two Techniques
1. Process Hollowing
2. Classic Process Hollowing
- Unlike process hollowing it will not overwrite the components
of the main thread but allocate a new memory region.
- Executes the shell  code when the main thread resumes.

=====WINAPI Required:=======
1. CreateProcess
2. VirtualAllocEx
3. WriteProcessMemory
4. QueueUserAPC
5. ResumeThread

"Sleeper Agent" Analogy
1. Identify a target Employee(suspend a legitimate process/thread)
2. Plant Secret Instructions(write shellcode into process memory)
3. Schedule a Covert Meeting(queue APC with shellcode address)
4. Give the activation Signal(resume thread--> Shellcode executes)


*******The "Sleeper Bus" Metaphor***************
QueueUserAPC Injection is like hiring a city bus driver as a secret courier:
You don't steal the bus or repaint it. Instead, you approach
a legitimate bus driver during their break, give them a 
sealed package (shellcode) to store in their locker 
(process memory), and tell them: "At your next scheduled 
stop check, open this package and follow the instructions." 
The driver continues their normal route, but at the designated 
moment, they execute your secret mission before returning to
 their regular duties. To passengers and dispatchers, 
 everything appears normal—the bus follows its route, 
 makes its stops, but secretly completes your delivery 
 when the driver checks their "special instructions folder" 
 (APC queue).
 *******************************************************


 ========Whats Done=========
 * Bypassed statisticall analysis now I have to bypass behaviral analysis.
 - The APC injection:
    1. Starts notepad in suspended state
    2. Download our payload from server(Linker to C2)
    3. Allocates memory to the payload
    4. Injects the shellcode to the target process
    5. Resume execution of the process and our shellcode runs.(Hiding our payload)

- Shellcode<made from donut>
    kali> donut -i main.exe -o main.bin
1. Download bot tokens and start to test
2. Get available token login to the chat and respond by executing whoami and sending message to the chat 
3. Ability to execute command and return feed back to the chat
4. Ability to exfiltrate a file to the chat

NOTE: Behavior analysis works as the first command that is run causes AV to catchup with it.
==========Remedy========
- Find a new way to execute commands with direct windows API calls
- Encrypt the payload using RSA to be downloaded and decrypted in memory
- Find a way to load the payload in encrypted HEX.X@
- Research on advanced AV techniques in Golang!!!!
-----------------------------------------------------------------------------
✅ Multi-Layer Evasion:
Hex String Storage - Bypassed static signature detection

XOR Encryption - Obfuscated payload in memory

Time Delays - Defeated sandbox analysis

Linker Obfuscation (-s -w) - Removed debug symbols

Runtime Decryption - Payload only exists in memory during execution
-COmpiling the final runner:
    cmd>> go build -ldflags="-s -w" -o shellcode_runner.exe main.go
----------------------More Info--------------------------------------------