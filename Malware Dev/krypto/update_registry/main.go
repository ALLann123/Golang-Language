package main

import (
	"fmt"

	"golang.org/x/sys/windows/registry"
)

func addToStartup(name, path string) error {
	//open registry
	key, _, err := registry.CreateKey(
		registry.CURRENT_USER,
		`SOFTWARE\Microsoft\Windows\CurrentVersion\Run`,
		registry.ALL_ACCESS,
	)

	if err != nil {
		return err
	}

	defer key.Close()

	//update the registry
	return key.SetStringValue(name, path)
}

func checkStartup(name, expecedPath string) bool {
	key, err := registry.OpenKey(
		registry.CURRENT_USER,
		`SOFTWARE\Microsoft\Windows\CurrentVersion\Run`,
		registry.QUERY_VALUE,
	)

	if err != nil {
		return false
	}

	defer key.Close()

	value, _, err := key.GetStringValue(name)

	return err == nil && value == expecedPath

}

func main() {
	//add to startup
	err := addToStartup("MyApp", "C:\\Windows\\System32\\calc.exe")

	if err != nil {
		fmt.Println("Error:", err)
		return
	}

	//check if it worked
	if checkStartup("MyApp", "C:\\Windows\\System32\\calc.exe") {
		fmt.Println("[+] Success! Registry updated.")
	} else {
		fmt.Println("[-] Failed to update registry.")
	}
}

/*
	cmd>> go run main.go
[+] Success! Registry updated.
*/