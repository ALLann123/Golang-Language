package main

import (
	"bufio"
	"fmt"
	"log"
	"net/http"

	tgbotapi "github.com/go-telegram-bot-api/telegram-bot-api/v5"
)

func main() {
	//our url target file
	url := "https://github.com/ALLann123/C2--Infrastructure/releases/download/v1.0.0/token.txt"

	//download directly into memory
	resp, err := http.Get(url)
	if err != nil {
		log.Fatalf("Failed to download file: %v", err)
	}
	defer resp.Body.Close()

	if resp.StatusCode != 200 {
		log.Fatalf("Bad Status: %s", resp.Status)
	}

	//scanner reads the response body as if its a file
	scanner := bufio.NewScanner(resp.Body)

	for scanner.Scan() {
		token := scanner.Text()

		if token == "" {
			continue
		}

		fmt.Printf("Testing token: %s\n", token)

		bot, err := tgbotapi.NewBotAPI(token)

		if err != nil {
			fmt.Printf("Invalid token: %s\n Error: %v\n\n", token, err)
			continue
		} else {
			fmt.Printf("VALID TOKEN: %s\nBotname: @%s\n\n", token, bot.Self.UserName)
			break
		}

	}
	if err := scanner.Err(); err != nil {
		log.Fatalf("Scanner error: %v", err)
	}
}
