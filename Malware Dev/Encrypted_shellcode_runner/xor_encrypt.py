#!/usr/bin/env python3
"""
Program 2: XOR Encrypt the hex string
"""

import sys
import binascii

def xor_encrypt_hex(hex_string, key):
    """Encrypt hex string using XOR with given key"""
    # Convert hex string to bytes
    try:
        original_bytes = bytes.fromhex(hex_string)
    except ValueError:
        print("[-] Error: Invalid hex string")
        return None
    
    print(f"[*] Original shellcode length: {len(original_bytes)} bytes")
    print(f"[*] XOR Key: {key} (0x{key:02x})")
    
    # XOR encrypt
    encrypted_bytes = bytes([b ^ key for b in original_bytes])
    encrypted_hex = binascii.hexlify(encrypted_bytes).decode()
    
    print(f"\n[+] Encrypted Shellcode:")
    print(f'encryptedHex := "{encrypted_hex}"')
    
    # Save to file for Go program
    with open("encrypted_shellcode.txt", "w") as f:
        f.write(encrypted_hex)
    
    print(f"\n[+] Saved to 'encrypted_shellcode.txt'")
    print(f"[+] XOR Key for Go program: {key}")
    
    return encrypted_hex

def main():
    if len(sys.argv) != 3:
        print("Usage: python xor_encrypt.py <hex_string_or_file> <xor_key>")
        print("Example: python xor_encrypt.py shellcode_hex.txt 170")
        sys.exit(1)
    
    input_arg = sys.argv[1]
    key = int(sys.argv[2])
    
    # Read hex string (either directly or from file)
    if input_arg.endswith('.txt'):
        with open(input_arg, 'r') as f:
            hex_string = f.read().strip()
    else:
        hex_string = input_arg
    
    encrypted = xor_encrypt_hex(hex_string, key)
    
    if encrypted:
        print(f"\n[+] Copy the encrypted hex and key to your Go program")

if __name__ == "__main__":
    main()