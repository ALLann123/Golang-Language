package main

import (
	"crypto/rand"
	"crypto/rsa"
	"crypto/sha256"
	"crypto/x509"
	"encoding/base64"
	"fmt"
)

func main() {
	//your Base64 public key
	publicKeyBase64 := "MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA8t3yvg9iXrHFUVzr1ngRotVexgb1jF94/5SbQeXQfOkIxPzJ86EEKjN8Eg2E6UGxLUw65oncMa4PTZhzZQtxl6IJ9nGhwAFBnlRWCvEzfqlH63U14+WFqWkIMqld3z6L6vsrX5Q5M19L9AYhqNDtQ3YHe9i4rJlJ1N/lcHu1Fm3KLmuCylVhIKcTpepHGmYtVFEtUR6gK54hn+FT3JB+xqPcilobUQ3Sdr3EFhaeJdiCn7oGCjit1VJEXWNuNKiDiGmzBp4pzdDtxfhWQlDZq+u1GvDqS0/fwviqtQuLwWP3a/AIpJgajLzHdQqmMNnKe7xOgYIC4TxC3vpyqtRK2wIDAQAB"

	//Text to encrypt
	plaintext := "MatundNewYourkJersMoi123"
	fmt.Printf("Plaintext: %s\n", plaintext)
	fmt.Printf("Plaintext Length: %d bytes\n", len(plaintext))

	//load the public key from Base64
	publicKey, err := loadPublicKeyFromBase64(publicKeyBase64)
	if err != nil {
		panic(err)
	}

	fmt.Printf("Public Key loaded: %d bits\n\n", publicKey.N.BitLen())

	//Encrypt the text
	encrypted, err := encryptWithPublicKey(publicKey, []byte(plaintext))
	if err != nil {
		panic(err)
	}

	//display results
	fmt.Println("Encrypred Output: ")
	//fmt.Println("="+strings.Repeat("=",60))

	//1. Show as Base64(single line)
	fmt.Println("Base64 (recomened for copying): ")
	fmt.Println(base64.StdEncoding.EncodeToString(encrypted))

}

func loadPublicKeyFromBase64(base64Key string) (*rsa.PublicKey, error) {
	//decodee from Base64
	derBytes, err := base64.StdEncoding.DecodeString(base64Key)
	if err != nil {
		return nil, fmt.Errorf("Failed to decode base64: %v", err)
	}

	//Parse the public key
	pubInterface, err := x509.ParsePKIXPublicKey(derBytes)
	if err != nil {
		return nil, fmt.Errorf("Failed to parse publuc key: %v", err)
	}

	publicKey, ok := pubInterface.(*rsa.PublicKey)
	if !ok {
		return nil, fmt.Errorf("not an RSA public key")
	}

	return publicKey, nil
}

func encryptWithPublicKey(publicKey *rsa.PublicKey, plaintext []byte) ([]byte, error) {
	//Use RSA-OAEP for secure encryption
	//this adds padding and is more secure than PKCS#1v1.5
	hash := sha256.New()
	label := []byte("") ///optional label

	ciphertext, err := rsa.EncryptOAEP(
		hash,
		rand.Reader,
		publicKey,
		plaintext,
		label,
	)

	return ciphertext, err
}

/*
Plaintext: MatundNewYourkJersMoi123
Plaintext Length: 24 bytes
Public Key loaded: 2048 bits

Encrypred Output:
Base64 (recomened for copying):
KjF3Ol96iSn4S3neDKCDpWM3ZdiFAEC1MCyMBkr4dVbTbsEOx+D39VJWhJD/4LIhRXT+xhdufsnF42PjJejQmz2ZMwCTTlpNtFMlGPCnH0ceqsofXaQ0V1cbpHO/YhXn7+nGQgdtffzCwafVgnWF+9bs4Jj9p9t1+AzxnzsupKvbTAXApavoALzBkL3vGQB5e4G98ztuNNKIaImKA++dd7w6x7I3O5NGyF03P5hHn4HTVha0sZe2Zvpy1TnkSE/y222+y31jr3j7xZAJQoEIG6+rHB7xBKT0NpZyBK9VComl5rNM7z9uLhb4QXuZ3N1H3ihFw5s2f8AVouwKpBBVPQ==
*/
