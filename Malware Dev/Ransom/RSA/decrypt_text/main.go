package main

import (
	"crypto/rand"
	"crypto/rsa"
	"crypto/sha256"
	"crypto/x509"
	"encoding/base64"
	"fmt"
)

func main() {
	//encrypted text
	encryptedBase64 := "KjF3Ol96iSn4S3neDKCDpWM3ZdiFAEC1MCyMBkr4dVbTbsEOx+D39VJWhJD/4LIhRXT+xhdufsnF42PjJejQmz2ZMwCTTlpNtFMlGPCnH0ceqsofXaQ0V1cbpHO/YhXn7+nGQgdtffzCwafVgnWF+9bs4Jj9p9t1+AzxnzsupKvbTAXApavoALzBkL3vGQB5e4G98ztuNNKIaImKA++dd7w6x7I3O5NGyF03P5hHn4HTVha0sZe2Zvpy1TnkSE/y222+y31jr3j7xZAJQoEIG6+rHB7xBKT0NpZyBK9VComl5rNM7z9uLhb4QXuZ3N1H3ihFw5s2f8AVouwKpBBVPQ=="

	//Base64 private key
	privateKeyBase64 := "MIIEpAIBAAKCAQEA8t3yvg9iXrHFUVzr1ngRotVexgb1jF94/5SbQeXQfOkIxPzJ86EEKjN8Eg2E6UGxLUw65oncMa4PTZhzZQtxl6IJ9nGhwAFBnlRWCvEzfqlH63U14+WFqWkIMqld3z6L6vsrX5Q5M19L9AYhqNDtQ3YHe9i4rJlJ1N/lcHu1Fm3KLmuCylVhIKcTpepHGmYtVFEtUR6gK54hn+FT3JB+xqPcilobUQ3Sdr3EFhaeJdiCn7oGCjit1VJEXWNuNKiDiGmzBp4pzdDtxfhWQlDZq+u1GvDqS0/fwviqtQuLwWP3a/AIpJgajLzHdQqmMNnKe7xOgYIC4TxC3vpyqtRK2wIDAQABAoIBACBhm1Xf8zuw9CAPBZrI04EkdchtcRvQNu/Mvo6gt5WP9I1fLwX+t/Fwf+BgURJQofDqMwg95U/yZzPvWaNlTTXscuua5vgUss0LbZVz52vB4kbwj8jc919JE8C9eDilvD4OUxAhUScaU6QrlR1PDfNqr0DB+o14urFZUNwYgmKE6mhKxOa9DqAq5Ivh+H4TKVr2TzZwSybo1hFSfnPw/JMg1beUF0I1SjtJ5AeQXhmn4Ope+klRFDFz3xCyPBRbS0q7tbfFlVeU81IzjMu17e+oRS124kGa4LCxXydEUz6fwGzKe5t/bENZPkdS1P+1YBbGDPxEqsKgk4If0e3I6BECgYEA9AOsx5Ub3HiKyGIPYPKXKCqry5tvGKFcYIMeLq/bE3KwwTXZzMi6MQg+oOnHdiGS4YUy6/sECngIXJa/HhJqSfDAZGT8h1EI2DFLtVuictRWHS4JlCgw6tabnxKtJdukHG0csSwxhYfy8QMTPI7cVCVz/7RBBZW/sANZsq/oAKcCgYEA/svYiVu4+uxjLC/q8WeC3SOP31CQ1n2KyxGc47YwKO/UJN5wSTEQLN6zqH3rfyVv6vvxyIut4oOMkicM8Llvg2u+n1TVk1X7vQKwhnAff+7IItxvz8PuFIS1LSG1zmcJ42rJ9HIo1JJAF7P4VzfdPbrxp0U1EIjayjWXI4tGlq0CgYA1Ia+3bXI5mU2uwBtVIr1jE5eAqAGSvV/d6+7gf44WN/zgtRcNjg9sqbzpUL4LrNfMnzItS+TfWq+HaZOHur7GBtP9iDesRyrD2EgB30gJ9M4jYGjZh77PA5ezFV/6RE8BmYiL03Gc/7MYY3EG2JyE/fq6DMezrZ2ld7VKQR8lNQKBgQC1es29cCY+Gxa8B1lJHlgYWFcGUSUIkRzFbMMZcc+1qLSqmgDSMO77dpfyP9X3ltuzPEZHeC2e8+Gwy72sy/eAXMLGS69fpNOMGZlP+BaHkbTdF7NQAZbW6Hr/LU6IN93ULGCyConIdm7OMzKENNcRO9EZOfME1uU3N5pyB6Z8dQKBgQDmIuLxgyQfFO7SKCi9kBNenl1T4AiT1ob3bYkvMYWdM3uKg9Accre3USuiWOpXFqF7Y6ho2D5JfiziQczuRQqkHQE5AXJKUrXGIlY3HOgpAZyacheyZO/SbqYl8Sp7P9v/YKTYLQOlC9rdQelhMF48VeOo8ECxAv2fFOE7LCh9vw=="

	fmt.Println("RSA Decryption Demo")

	//load private key
	privateKey, err := loadPrivateKeyFromBase64(privateKeyBase64)
	if err != nil {
		panic(err)
	}
	fmt.Println("Private Key loaded successfully")

	//decrypt the text
	plaintext, err := decryptWithPrivateKey(privateKey, encryptedBase64)
	if err != nil {
		fmt.Printf("Error Decrypting: %v\n", err)
		return
	}

	fmt.Println("\nDecryption Results:")
	fmt.Printf("Decrypted text: %s\n", plaintext)
	fmt.Printf("Length: %d bytes\n", len(plaintext))
	fmt.Printf("Original encrypted size: %d bytes\n", len(encryptedBase64))
}

func loadPrivateKeyFromBase64(base64Key string) (*rsa.PrivateKey, error) {
	//decode from base64
	derBytes, err := base64.StdEncoding.DecodeString(base64Key)
	if err != nil {
		return nil, fmt.Errorf("failed to decode base64 private key: %v", err)
	}

	//parse the private key(PKCS#1 format)
	privateKey, err := x509.ParsePKCS1PrivateKey(derBytes)
	if err != nil {
		return nil, fmt.Errorf("Failed to parse private Key: %v", err)
	}

	return privateKey, nil
}

func decryptWithPrivateKey(privateKey *rsa.PrivateKey, encryptedBase64 string) (string, error) {
	//decode base64 ciphertext
	ciphertext, err := base64.StdEncoding.DecodeString(encryptedBase64)
	if err != nil {
		return "", fmt.Errorf("Failed to decode base64 ciphertext: %v", err)
	}

	fmt.Printf("Ciphertext length: %d bytes\n", len(ciphertext))

	//decrypt with RSA-OAEP(same as encryption)
	hash := sha256.New()
	label := []byte("") ///must match encryption label

	plaintext, err := rsa.DecryptOAEP(
		hash,
		rand.Reader,
		privateKey,
		ciphertext,
		label,
	)

	if err != nil {
		return "", fmt.Errorf("decryption failed: %v", err)
	}

	return string(plaintext), nil
}

/*
go run main.go
RSA Decryption Demo
Private Key loaded successfully
Ciphertext length: 256 bytes

Decryption Results:
Decrypted text: MatundNewYourkJersMoi123
*/
